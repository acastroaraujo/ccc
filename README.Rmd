---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.path = "man/figures/README-",
  comment = "#"
)
```


```{r, out.width="40%", echo=FALSE, align="center"}
knitr::include_graphics("man/figures/logo.png")
```

# ccc

<!-- badges: start -->

<!-- badges: end -->

The `ccc` package helps get information from the Colombian Constitutional Court.

You can install the current version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("acastroaraujo/ccc")
```

It has the following functions:

- `ccc_search`
- `ccc_clean_data`
- `ccc_txt`
- `ccc_rtf`
- `extract_citations`

And the following datasets:

- `metadata`
- `citations`
- `docterms`

These datasets were created using these [scripts](https://github.com/acastroaraujo/ccc/tree/master/data-raw).

## Data

```{r, warning=FALSE, message=FALSE}
library(ccc)
library(dplyr)
```


There are 3 built-in datasets in this package, which cover 30 years after the first ruling was published.

```{r}
glimpse(citations)
```

```{r}
glimpse(metadata)
```

```{r}
glimpse(docterms)
```

You can get a document-term matrix instead of `docterms` easily with the `create_dtm()` function. The result will be a very sparse matrix.

I recommend that you load the `Matrix` package if you're going to work with this object.

```{r}
library(Matrix)

M <- create_dtm()
dim(M)

mean(M == 0) ## sparsity
M[sample(nrow(M), 20), sample(ncol(M), 5)] ## random subset
```


## Download

Use the `ccc_search()` function to look up some cases.

```{r}
results <- ccc_search(
  text = "familia", 
  date_start = "1999-01-01", 
  date_end = "2001-12-31"
)

glimpse(results)
```

This data is a little messy. The `ccc_clean_dataset()` provides some useful tidying, but you might want to consider doing things differently.

```{r}
df <- ccc_clean_dataset(results)
glimpse(df)
```

Next you'll want to download some texts. You can use either `ccc_txt()` or `ccc_rtf()`. I prefer `ccc_txt()` because most rtf files don't include footnotes.

Here I'll show you how to download 5 random rulings.

```{r}
df_subset <- slice_sample(df, n = 5)

txts <- vector("list", nrow(df_subset))

for (i in seq_along(txts)) {
  txts[[i]] <- ccc_txt(df_subset$url[[i]])
}

names(txts) <- df_subset$id

glimpse(txts)
```

Finally, you can `extract_citations()` easily as follows:

```{r}
lapply(txts, extract_citations)
```

